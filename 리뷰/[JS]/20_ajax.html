<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ajax</title>
</head>
<body>
    <script>
        /*
            [ajax]
            - 정의 : 자바스크립트와 xml간 비동기 통신
            - 통신방식
                (1) 동기통신
                    - 순서대로 통신
                    - 요청하고 응답을 기다리는 통신으로 느림
                (2)  비동기통신(디폴트)
                    - 순서를 지키지 않는 통신
                    - 응답이 오지 않더라도 요청을 계속할 수 있음
                    - 응답이 오면 해당 응답만 처리하면됨
            - 페이지 전체를 로드하지 않고, 페이지의 일부만 요청해 처리하는 기능
            (ex 댓글을 추가할때, 새로고침이 아닌 댓글 내용만 추가되는 경우)
            - 사용조건 : 자바스크립트의 XMLHttpRequest 객체가 ajax 처리를 담당함        
        */
    </script>

    <div><button id="btn1">클릭</button></div>
    <div id="box1"></div>
    <script>
        document.getElementById('btn1').onclick = function(event) {

            // 가정 ) data.txt 파일이 서버가 보낸 데이터

            // 1. XMLHttpRequest 객체 생성
            var xhr = new XMLHttpRequest();

            // 2. open() - 요청정보 만들기
            xhr.open('GET', 'data.txt', true);

            // xmlhttprequest의 객체.open('http메서드', '요청서버경로', '통신방식')
            // (1) http메서드   : get / post 방식
            // (2) 요청서버경로 : 컨텍스트패스/ URLMapping  (jsp)
            // (3) 통신방식     : 동기 통신(false), 비동기통신(true)

            // 3. send() - 요청하기
            xhr.send();

            // 4. 응답처리
            // - 응답이 오는지 점검하는 readystatechange 이벤트가 필요
            xhr.onreadystatechange = function(event) {
            
            // 1) 응답에 관련된 속성
                // (1) readyState(통신확인)
                //  (1) 4   : 통신됨 
                //  (2) 0~3 : 통신안됨
                // (2) status(응답 코드)
                //  (1) 200 : 응답성공
                //  (2) 40x : 요청실패
                //  (3) 50x : 서버오류
            if(xhr.readyState == 4 && xhr.status == 200) {
                document.getElementById('box1').textContent = xhr.responseText;
            // 2) 응답 데이터 속성
            //      (1) 텍스트 형식 : responseText
            //      (2) xml    형식 : responseXML
            //      (3) json   형식 : json.parse(responseText)
            }
            }
        }
    </script>

    <hr>

    <!-- 1. XML 읽기 -->
    <div><button id="btn2">클릭</button></div>
    <div id="box2">
        <table border="1">
            <thead>
                <tr>
                    <td>제목</td>
                    <td>저자</td>
                    <td>가격</td>
                </tr>
            </thead>
            <tbody class="book_list"></tbody>
        </table>
    </div>
    <script>
        document.getElementById('btn2').onclick = function(event) {
            var xhr = new XMLHttpRequest();
            xhr.open('get', 'books1.xml', true);
            xhr.send()
            xhr.onreadystatechange = function(event) {
                if(xhr.readyState == 4 && xhr.status == 200) {

                    // 1) XML응답은 responseXML 속성으로 받아옴
                    var data = xhr.responseXML;
                    // console.log(data);

                    // 2) <books> 태그 가져오기
                    var books = data.getElementsByTagName('books')[0];
                    // console.log(books);

                    // & tagName으로 반환되는 값은 배열이다
                    // (1) [0]을 안붙이면 요소 자체가 콘솔에 출력된다
                    // (2) [0]을 붙이면 배열의 0번째 인덱스에 저장된 값을 가져온다
                    // - 배열의 값을 가져오기 위해서는 인덱스를 사용해야한다
                    // - 값이 하나라도 배열로 저장된 값은 인덱스[0]을 사용해야한다
                    // - 값이 여러개일경우 반복문 for을 이용하면된다[i]

                    // & tagName은 반환을 배열로 하기 때문에,
                    // 내용 확인을 위해서는 [0]을 사용해야한다 
                    // books1 문서상, books는 1개


                    // 3) <book> 태그 가져오기 (3개)
                    var book = books.getElementsByTagName('book');
                    // console.log(book);

                    // & 마찬가지 이유로 book도 배열이기 때문에 값을 얻기 위해서는 인덱스가 필요하다
                    // book 요소는 문서상 3개로 [0], [1], [2] 각각 요소의 값이 나온다
                    // => 복수의 요소를 가졌기 때문에 반복문for을 사용한다
                    var booklist = '';
                    for(let i = 0; i < book.length; i++) {
                        booklist += '<tr>';
                        booklist += '<td>' + book[i].getElementsByTagName('title')[0].textContent + '</td>';
                        booklist += '<td>' + book[i].getElementsByTagName('author')[0].textContent + '</td>';
                        booklist += '<td>' + book[i].getElementsByTagName('price')[0].textContent + '</td>';
                        booklist += '</tr>';
                    }
                    document.querySelector('#box2 .book_list').innerHTML = booklist;
                }
            }
        }
    </script>

    <!-- 2. XML 읽기 -->
    <div><button id="btn3">클릭</button></div>
    <div id="box3">
        <table border="1">
            <thead>
                <tr>
                    <td>제목</td>
                    <td>저자</td>
                    <td>가격</td>
                </tr>
            </thead>
            <tbody class="book_list"></tbody>
        </table>
    </div>
    <script>
        document.getElementById('btn3').onclick = function(event) {
            var xhr = new XMLHttpRequest();
            xhr.open('get', 'books2.mxl', true);
            xhr.send();
            xhr.onreadystatechange() = function(event) {
            // & onreadystatechange는 fuction 이벤트(응답이 오는지 점검하기 위한)
                if(xhr.readyState == 4 && xhr.status == 200)
                // readyState   : 통신확인
                // status       : 응답코드

                var data = xhr.responseXML;
                // => 응답받은 xml 데이터를 data 변수에 저장
                var books = xhr.getElementsByTagName('books')[0];
                var book = xhr.getElementsByTagName('book');
                var bookList = '';
                console.log(bookList);
                for(let i = 0; i < book.length; i++) {
                    
                }
            }
        }
    </script>

      <!-- 3. XML 읽기 연습 - naver_search.xml -->
      <div><button id="btn4">클릭</button></div>
      <div id="box4">
          <table border="1">
              <thead>
                  <tr>
                      <td>제목(title)</td>
                      <td>썸네일(image+link)</td>
                      <td>저자(author)</td>
                      <td>정상가(price)</td>
                      <td>할인가(discount)</td>
                      <td>출판사(publisher)</td>
                      <td>출판일(pubdate)</td>
                      <td>ISBN(isbn)</td>
                      <td>개요(description)</td>
                  </tr>
              </thead>
              <tbody id="search_list"></tbody>
          </table>
      </div>
      <script>
        documment.getElementById('btn4').onclick = function(event) {

            // 요청 작성
            var xhr = new XMLHttpRequest();
            xhr.open('get', 'naver_search.xml', true);
            xhr.send();
            // 응답 처리 확인
            xhr.onreadystatechange = function(event) {
                if(xhr.readyState == 4 && xhr.status == 200) {
                    var data = xhr.responseXML;
                    var item = data.getElementsByTagName('item');
                    var itemList = '';
                    for(let i = 0; i < item.length; i++) {
                        itemList += '<tr>';
                        itemList += '<td>' + item[i].getElementsByTagName('title')[0].textContent + "</td>";
                        itemList += '<td>' + '<a href=' + item.[i].getElementsByTagName('link')[0].textContent + "</td>";
                        itemList += '<td>' + item[i].getElementsByTagName('title')[0].textContent + "</td>";
                        itemList += '<td>' + item[i].getElementsByTagName('title')[0].textContent + "</td>";
                        itemList += '<td>' + item[i].getElementsByTagName('title')[0].textContent + "</td>";
                        itemList += '<td>' + item[i].getElementsByTagName('title')[0].textContent + "</td>";
                        itemList += '<td>' + item[i].getElementsByTagName('title')[0].textContent + "</td>";

                    }
                }
            }
        }
      </script>

       <!-- 4. XML 읽기 연습 - sfc_web_map.xml -->

       <!-- 5. JSON 읽기 -->

        <!-- 6. JSON 읽기 -->

        <!-- 7. JSON 읽기 연습 - cctv.json -->
    
</body>
</html>